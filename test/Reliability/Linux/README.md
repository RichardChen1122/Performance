# Description
This setup is intended for reliability or performance tests for Kestrel and ASP.NET core on Linux

# Server Setup

- Create A2 Standard Ubuntu VM on Azure
- Install dnvm and DNX, and libuv
https://docs.asp.net/en/latest/getting-started/installing-on-linux.html
- Install Nginx
```sh
$ sudo apt-get install nginx
```
- Run testapp\HelloWorldMVC application on a specific port, say http://*:5000
        cd testapp\HelloWorldMvc
        dotnet restore
        dotnet run server.urls=http://*:5000
- Create and enable the site/application
    - Create a configuration file for a new site and enable reverse proxy
            /etc/nginx/sites-available/mysite
                    
            server {
                listen 8080;		 
                location / {
                        proxy_set_header    Host $host;
                        proxy_set_header    X-Real-IP   $remote_addr;
                        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
                        proxy_pass  http://localhost:5000;
                }
            }
    - Link the configuration as enabled site:
            ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/mysite
    - Restart nginx
            sudo service nginx restart
        Now all requests to 8080 will be proxy to 5000 where the Kestrel server listens to
- Collect server perf counters for process dnx an nginx:
       	top | grep 'dnx\|nginx' > cpumemlog.log
- If want to aggregate the data of the same process name (like aggregate for multiple nginx), we can post-process above log generated by top, or we can use atop:
        sudo apt-get install atop
        atop -M -m -p 1 >atoplog.log

# Client Setup

- Create A2 Standard windows VM on Azure
- Copy the contents of this folder
- Replace the server name/IP in settings.ubr file with the server name/ip that you created during "Server Setup" steps above. 
- Update scenario.ubr with the duration needed (in seconds).
- Run 
        wcat.cmd




